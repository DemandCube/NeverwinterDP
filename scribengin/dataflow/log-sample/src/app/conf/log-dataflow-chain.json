{
  "submitter": "Order",

  "descriptors": [
    {
      "id" :   "log-splitter-dataflow-1",
      "name" : "log-splitter-dataflow",

      "numberOfWorkers" : 2,
      "numberOfExecutorsPerWorker" : 3,
      "maxRunTime": 900000,
      "maxWaitForDataRead": 15000,
      "taskSwitchingPeriod" : 30000,
      "scribe" : "com.neverwinterdp.dataflow.logsample.LogMessageSplitter",

      "sourceDescriptor" : {
        "type" : "kafka", "topic" : "log4j", "zk.connect" : "zookeeper-1:2181", "reader" : "raw", "name" : "LogSplitterDataflow"
      },

      "sinkDescriptors" : {
        "default" : {
          "type" : "elasticsearch", 
          "address" : "elasticsearch-1:9300", "indexName": "dataflow_app_log", "mappingType": "com.neverwinterdp.util.log.Log4jRecord"
        },

        "warn" : {
          "type" : "kafka", "topic" : "log4j.warn", "zk.connect" : "zookeeper-1:2181", "name" : "LogSplitterDataflow"
        },

        "error" : {
          "type" : "kafka", "topic" : "log4j.error", "zk.connect" : "zookeeper-1:2181", "name" : "LogSplitterDataflow"
        },

        "info" : {
          "type" : "kafka", "topic" : "log4j.info", "zk.connect" : "zookeeper-1:2181", "name" : "LogSplitterDataflow"
        }
      },

      "loggerConfig" : {
        "logLevel" : "INFO ",
        "consoleAppender" : { "enable" : false },

        "fileAppender" : {
          "enable" : true, "name" : "file", "filePath" : "build/logs/vm.log", "maxSizeInMb" : 5, "maxBackup" : 5
        },
        
        "esAppender" : {
          "enable" : true, "name" : "es", "connects" : "elasticsearch-1:9300", "bufferDir" : "build/data/buffer/es/log4j", "indexName" : "log4j"
        },

        "kafkaAppender" : {
          "enable" : true, "name" : "kafka", "connects" : "kafka-1:9092, kafka-2:9092, kafka-3:9092", "bufferDir" : "build/data/buffer/kafka/log4j", "topic" : "log4j"
        }
      }
    },

    {
      "id" :   "log-persister-dataflow-info",
      "name" : "log-persister-dataflow",
      "numberOfWorkers" : 2,
      "numberOfExecutorsPerWorker" : 3,
      "maxRunTime": 1800000,
      "maxWaitForDataRead": 15000,
      "taskSwitchingPeriod" : 30000,
      "scribe" : "com.neverwinterdp.dataflow.logsample.LogMessagePerister",

      "sourceDescriptor" : {
        "type" : "kafka", "topic" : "log4j.info", "zk.connect" : "zookeeper-1:2181", "reader" : "record", "name" : "LogSampleDataflow"
      },
      "sinkDescriptors" : {
        "kafka" : {
          "type" : "kafka", "topic" : "log4j.aggregate", "zk.connect" : "zookeeper-1:2181", "name" : "InfoLogPersisterDataflow"
        },

        "hdfs" : {
          "type" : "HDFS", "location" : "build/hdfs/info"
        },

        "elasticsearch" : {
          "type" : "elasticsearch", 
          "address" : "elasticsearch-1:9300", "indexName": "dataflow_log_sample", "mappingType": "com.neverwinterdp.util.log.Log4jRecord"
        }
      },

      "loggerConfig" : {
        "logLevel" : "INFO ",
        "consoleAppender" : { "enable" : false },

        "fileAppender" : { 
          "enable" : true, "name" : "file", "filePath" : "build/logs/vm.log", "maxSizeInMb" : 5, "maxBackup" : 5 
        },
        
        "esAppender" : { 
          "enable" : true, "name" : "es", "connects" : "elasticsearch-1:9300", "bufferDir" : "build/data/buffer/es/log4j", "indexName" : "log4j" 
        },
        
        "kafkaAppender" : {
          "enable" : true, "name" : "kafka", "connects" : "kafka-1:9092,kafka-2:9092,kafka-3:9092", "bufferDir" : "build/data/buffer/kafka/log4j", "topic" : "log4j"
        }
      }
    },

    {
      "id" :   "log-persister-dataflow-warn",
      "name" : "log-persister-dataflow",
      "numberOfWorkers" : 2,
      "numberOfExecutorsPerWorker" : 3,
      "maxRunTime": 1800000,
      "maxWaitForDataRead": 15000,
      "taskSwitchingPeriod" : 30000,
      "scribe" : "com.neverwinterdp.dataflow.logsample.LogMessagePerister",

      "sourceDescriptor" : {
        "type" : "kafka", "topic" : "log4j.warn", "zk.connect" : "zookeeper-1:2181", "reader" : "record", "name" : "LogSampleDataflow"
      },

      "sinkDescriptors" : {
        "kafka" : {
          "type" : "kafka", "topic" : "log4j.aggregate", "zk.connect" : "zookeeper-1:2181", "name" : "WarnLogPersisterDataflow"
        },

        "hdfs" : {
          "type" : "HDFS", "location" : "build/hdfs/warn"
        },

        "elasticsearch" : {
          "type" : "elasticsearch", 
          "address" : "elasticsearch-1:9300", "indexName": "dataflow_log_sample", "mappingType": "com.neverwinterdp.util.log.Log4jRecord"
        }
      },
      "loggerConfig" : {
        "logLevel" : "INFO ",
        "consoleAppender" : { "enable" : false },

        "fileAppender" : { 
          "enable" : true, "name" : "file", "filePath" : "build/logs/vm.log", "maxSizeInMb" : 5, "maxBackup" : 5 
        },
        
        "esAppender" : { 
          "enable" : true, "name" : "es", "connects" : "elasticsearch-1:9300", "bufferDir" : "build/data/buffer/es/log4j", "indexName" : "log4j" 
        },
        
        "kafkaAppender" : {
          "enable" : true, "name" : "kafka", "connects" : "kafka-1:9092,kafka-2:9092,kafka-3:9092", "bufferDir" : "build/data/buffer/kafka/log4j", "topic" : "log4j"
        }
      }
    },

    {
      "id" :   "log-persister-dataflow-error",
      "name" : "log-persister-dataflow",
      "numberOfWorkers" : 2,
      "numberOfExecutorsPerWorker" : 3,
      "maxRunTime": 1800000,
      "maxWaitForDataRead": 15000,
      "taskSwitchingPeriod" : 30000,
      "scribe" : "com.neverwinterdp.dataflow.logsample.LogMessagePerister",

      "sourceDescriptor" : {
        "type" : "kafka", "topic" : "log4j.error", "zk.connect" : "zookeeper-1:2181", "reader" : "record", "name" : "LogSampleDataflow"
      },

      "sinkDescriptors" : {
        "kafka" : {
          "type" : "kafka", "topic" : "log4j.aggregate", "zk.connect" : "zookeeper-1:2181", "name" : "ErrorLogPersisterDataflow"
        },

        "hdfs" : {
          "type" : "HDFS", "location" : "build/hdfs/error"
        },

        "elasticsearch" : {
          "type" : "elasticsearch", 
          "address" : "elasticsearch-1:9300", "indexName": "dataflow_log_sample", "mappingType": "com.neverwinterdp.util.log.Log4jRecord"
        }
      },
      "loggerConfig" : {
        "logLevel" : "INFO ",
        "consoleAppender" : { "enable" : false },

        "fileAppender" : { 
          "enable" : true, "name" : "file", "filePath" : "build/logs/vm.log", "maxSizeInMb" : 5, "maxBackup" : 5 
        },
        
        "esAppender" : { 
          "enable" : true, "name" : "es", "connects" : "elasticsearch-1:9300", "bufferDir" : "build/data/buffer/es/log4j", "indexName" : "log4j" 
        },
        
        "kafkaAppender" : {
          "enable" : true, "name" : "kafka", "connects" : "kafka-1:9092,kafka-2:9092,kafka-3:9092", "bufferDir" : "build/data/buffer/kafka/log4j", "topic" : "log4j"
        }
      }
    }
  ]
}
